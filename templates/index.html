<!DOCTYPE html>
<html>
<head>
<title>Joy SKU Tracker</title>
<style>
table {border-collapse: collapse;}
td,th {border:1px solid #ccc;padding:4px;}
progress{width:300px;}
</style>
</head>
<body>
<h2>Joy SKU Tracker</h2>

<table id="table">
<tr>
  <th>SKU</th>
  <th>Marque</th>
  <th>Produit</th>
  <th>Contenance</th>
</tr>
</table>

<button onclick="addRow()">Ajouter ligne</button>
<button onclick="run()">Lancer</button>

<br><br>
<progress id="bar" value="0" max="100"></progress>

<script>
function addRow(){
 const t=document.getElementById("table");
 const r=t.insertRow();
 for(let i=0;i<4;i++){
   r.insertCell().innerHTML='<input>';
 }
}
for(let i=0;i<5;i++) addRow();

function run(){
 const rows=[];
 document.querySelectorAll("#table tr").forEach((r,i)=>{
  if(i===0) return;
  const c=r.querySelectorAll("input");
  if(c[0].value) rows.push({sku:c[0].value});
 });

 document.getElementById("bar").value=40;

 fetch("/run",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({rows})
 })
 .then(r=>r.json())
 .then(d=>{
    document.getElementById("bar").value=100;

    // ðŸ”½ DÃ©clenche automatiquement le tÃ©lÃ©chargement
    window.location.href = d.download_url;
 });
}

</script>

</body>
</html>
